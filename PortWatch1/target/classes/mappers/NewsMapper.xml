<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
NewsMapper - 뉴스 SQL 매퍼 (실제 DB 스키마 기준)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 실제 news 테이블에 있는 컬럼만 사용
✅ stock_id, stock_code, stock_name 제거 (테이블에 없음)
✅ 기본 컬럼만 사용하여 안전성 확보

2025-12-29: 실제 DB 스키마에 맞춰 수정
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-->

<mapper namespace="com.portwatch.persistence.NewsDAO">

    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         ResultMap 정의 - 실제 DB 테이블 컬럼만 사용
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <resultMap id="NewsResultMap" type="com.portwatch.domain.NewsVO">
        <id property="newsId" column="news_id"/>
        <result property="title" column="title"/>
        <result property="link" column="link"/>
        <result property="content" column="content"/>
        <result property="source" column="source"/>
        <result property="publishedAt" column="published_at"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         최근 뉴스 조회
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         
         파라미터:
         - limit: 조회할 뉴스 개수
         
         ✅ selectRecentNews - DAO 메서드명과 일치
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <select id="selectRecentNews" parameterType="int" resultMap="NewsResultMap">
        SELECT 
            news_id,
            title,
            link,
            content,
            source,
            published_at,
            created_at
        FROM news
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>

    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         뉴스 검색
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         
         파라미터:
         - keyword: 검색 키워드
         - limit: 조회할 뉴스 개수
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <select id="search" resultMap="NewsResultMap">
        SELECT 
            news_id,
            title,
            link,
            content,
            source,
            published_at,
            created_at
        FROM news
        WHERE title LIKE CONCAT('%', #{keyword}, '%')
           OR content LIKE CONCAT('%', #{keyword}, '%')
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>

    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         뉴스 상세 조회
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <select id="selectById" parameterType="long" resultMap="NewsResultMap">
        SELECT 
            news_id,
            title,
            link,
            content,
            source,
            published_at,
            created_at
        FROM news
        WHERE news_id = #{newsId}
    </select>

    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         뉴스 등록
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <insert id="insert" parameterType="com.portwatch.domain.NewsVO">
        INSERT INTO news (
            title,
            link,
            content,
            source,
            published_at
        ) VALUES (
            #{title},
            #{link},
            #{content},
            #{source},
            #{publishedAt}
        )
    </insert>

    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         뉴스 삭제
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <delete id="delete" parameterType="long">
        DELETE FROM news
        WHERE news_id = #{newsId}
    </delete>

    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         전체 뉴스 개수 조회
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <select id="count" resultType="int">
        SELECT COUNT(*) FROM news
    </select>

</mapper>
