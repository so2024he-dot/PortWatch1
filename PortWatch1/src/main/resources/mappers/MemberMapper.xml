<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
<!-- MemberMapper.xml - 회원 SQL 매퍼 -->
<!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->

<mapper namespace="com.portwatch.mapper.MemberMapper">
    
    <!-- ResultMap 정의 -->
    <resultMap id="memberResultMap" type="MemberVO">
        <id property="memberId" column="member_id"/>
        <result property="memberEmail" column="member_email"/>
        <result property="memberPass" column="member_pass"/>
        <result property="memberName" column="member_name"/>
        <result property="memberPhone" column="member_phone"/>
        <result property="memberAddress" column="member_address"/>
        <result property="memberBirth" column="member_birth"/>
        <result property="memberGender" column="member_gender"/>
        <result property="memberStatus" column="member_status"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <!-- 회원 등록 -->
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <insert id="insert" parameterType="MemberVO">
        INSERT INTO MEMBER (
            member_id, 
            member_email, 
            member_pass, 
            member_name,
            member_phone, 
            member_address, 
            member_birth, 
            member_gender,
            member_status, 
            created_at, 
            updated_at
        ) VALUES (
            #{memberId}, 
            #{memberEmail}, 
            #{memberPass}, 
            #{memberName},
            #{memberPhone}, 
            #{memberAddress}, 
            #{memberBirth}, 
            #{memberGender},
            COALESCE(#{memberStatus}, 'ACTIVE'), 
            NOW(), 
            NOW()
        )
    </insert>
    
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <!-- 회원 조회 (ID) -->
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <select id="findById" parameterType="string" resultMap="memberResultMap">
        SELECT 
            member_id, 
            member_email, 
            member_pass, 
            member_name,
            member_phone, 
            member_address, 
            member_birth, 
            member_gender,
            member_status, 
            created_at, 
            updated_at
        FROM MEMBER 
        WHERE member_id = #{memberId}
    </select>
    
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <!-- 회원 조회 (이메일) -->
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <select id="findByEmail" parameterType="string" resultMap="memberResultMap">
        SELECT 
            member_id, 
            member_email, 
            member_pass, 
            member_name,
            member_phone, 
            member_address, 
            member_birth, 
            member_gender,
            member_status, 
            created_at, 
            updated_at
        FROM MEMBER 
        WHERE member_email = #{memberEmail}
    </select>
    
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <!-- 회원 정보 수정 -->
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <update id="update" parameterType="MemberVO">
        UPDATE MEMBER
        SET member_email = #{memberEmail},
            <if test="memberPass != null and memberPass != ''">
                member_pass = #{memberPass},
            </if>
            member_name = #{memberName},
            member_phone = #{memberPhone},
            member_address = #{memberAddress},
            member_birth = #{memberBirth},
            member_gender = #{memberGender},
            member_status = #{memberStatus},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <!-- 회원 삭제 -->
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <delete id="delete" parameterType="string">
        DELETE FROM MEMBER 
        WHERE member_id = #{memberId}
    </delete>
    
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <!-- 전체 회원 수 조회 -->
    <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
    <select id="count" resultType="int">
        SELECT COUNT(*) 
        FROM MEMBER
    </select>
    
</mapper>
